---
// @ts-nocheck
import LegacyLayout from "../layouts/LegacyLayout.astro";
import LegacyHeader from "../components/LegacyHeader.astro";
import LegacyFooter from "../components/LegacyFooter.astro";

const politicsEntries = Object.entries(
  import.meta.glob("../content/politics/*.md", { eager: true })
);

const allPolitics = politicsEntries.map(([path, mod]) => ({
  ...(mod as { frontmatter: any }).frontmatter,
  slug: path.split("/").pop().replace(".md", ""),
}));

allPolitics.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

const seed = new Date().getDate();
const offset = allPolitics.length ? seed % allPolitics.length : 0;
const rotated = allPolitics.slice(offset).concat(allPolitics.slice(0, offset));
const currentBatch = rotated.slice(0, 8);
const leadStory = currentBatch[0];
const topStories = currentBatch.slice(1);
const sideStories = currentBatch.slice(0, 2);
---
<LegacyLayout
  title="Minnesota Politics @ mp.ls"
  description="Political headlines and Minnesota-focused stories curated in the mp.ls politics section."
>
<div class="mpls-legacy">
<LegacyHeader showNav />


<div class="news-container">
  <div class="news-layout">
    <div class="news-main">
      <h1 class="news-title">MINNESOTA POLITICS</h1>
      <p class="news-subtitle">Updated daily - Statehouse / City Hall</p>
      <hr class="news-divider">

      <h2 class="section-title">LEAD STORY</h2>
      {leadStory && (
        <div class="lead-story-container">
          {leadStory.image && (
            <div class="lead-image">
              <img src={leadStory.image} alt={leadStory.title}>
            </div>
          )}
          <div class="lead-story-content">
            <h3 class="story-headline"><a class="story-link" href={`/politics/${leadStory.slug}/`}>{leadStory.title}</a></h3>
            <p class="story-source">{leadStory.source || "Wire report"}.</p>
            <p class="story-date"><strong>{leadStory.displayDate || leadStory.date}</strong></p>
          </div>
        </div>
      )}
      <hr class="news-divider">

      <h2 class="section-title">TOP STORIES</h2>
      <div class="stories-list">
        {topStories.map((story) => (
          <div class="story-item">
            <div class="story-image">
              {story.image && (
                <img src={story.image} alt={story.title}>
              )}
            </div>
            <div class="story-content">
              <p class="story-text">
                <strong>{story.displayDate || story.date}</strong> - <a class="story-link" href={`/politics/${story.slug}/`}>{story.title}</a><br>
                <span class="story-source-small">{story.source}</span>
              </p>
            </div>
          </div>
        ))}
      </div>
    </div>

    <aside class="news-sidebar">
      <div class="sidebar-header">
      </div>
      <h2 class="section-title">BREAKING</h2>
      <p class="sidebar-text">Fresh items are pulled from live feeds when available.</p>
      
      <hr class="sidebar-divider">

      <h2 class="section-title">ON THE WIRE</h2>
      {sideStories.map((story) =>
        story.image && (
          <div class="sidebar-image">
            <img src={story.image} alt={story.title}>
          </div>
        )
      )}
      {topStories.slice(0, 3).map((story) => (
        <p class="sidebar-link"><a class="story-link" href={`/politics/${story.slug}/`}>{story.title}</a></p>
      ))}
      <hr class="sidebar-divider">

      <h2 class="section-title">QUICK LINKS</h2>
      <p class="sidebar-link"><a href="/news/">News Desk</a></p>
      <p class="sidebar-link"><a href="/weather/">Weather Center</a></p>
      <p class="sidebar-link"><a href="/sports/">Sports</a></p>
      <p class="sidebar-link"><a href="/media/">Media</a></p>
    </aside>
  </div>
</div>

<LegacyFooter />
</div>
</LegacyLayout>
